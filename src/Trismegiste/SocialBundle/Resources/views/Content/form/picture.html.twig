{% extends 'TrismegisteSocialBundle:Content:publishing_form.html.twig' %}

{% block crud %}
    <input type="file" id="first-stage-upload"/>
    <img id="upload-preview"/>
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">

        $('#first-stage-upload').on('change', function (event) {
            var input = event.target;

            if (input.files && input.files[0]) {
                var selectFile = input.files[0]
                console.log(selectFile)
                var reader = new FileReader();

                reader.onload = function (event) {
                    $('#upload-preview').attr('src', event.target.result)
                }
                reader.readAsDataURL(selectFile)
                $('#{{ form.storageKey.vars.id }}').val(selectFile.name)
                $('#{{ form.mimeType.vars.id }}').val(selectFile.type)
            }
        })

        $('#{{ form.save.vars.id }}').on('click', function (event) {
            event.stopPropagation()
            event.preventDefault()

            $.ajax({
                type: 'POST',
                url: '{{ path('picture_upload') }}',
                data: {
                    picture: 'toto'
                }
            }).done(function () {
                alert('ok')
            }).fail(function () {
                alert('Your browser does not support this feature')
            });
        })

    </script>
{% endblock %}
