/* liteUploader v2.1.0 | https://github.com/burt202/lite-uploader | Aaron Burtnyk (http://www.burtdev.net) */

function LiteUploader(e,t){this.el=$(e);this.options=t;this.params=t.params;this.xhr=this._buildXhrObject();this._init()}$.fn.liteUploader=function(e){var t={script:null,rules:{allowedFileTypes:null,maxSize:null},params:{},changeHandler:true,clickElement:null};return this.each(function(){$.data(this,"liteUploader",new LiteUploader(this,$.extend(t,e)))})};LiteUploader.prototype={_init:function(){if(this.options.changeHandler){this.el.change(function(){this._start()}.bind(this))}if(this.options.clickElement){this.options.clickElement.click(function(){this._start()}.bind(this))}},_buildXhrObject:function(){var e=new XMLHttpRequest;e.upload.addEventListener("progress",this._onProgress.bind(this),false);return e},_onProgress:function(e){if(e.lengthComputable){this.el.trigger("lu:progress",Math.floor(e.loaded/e.total*100))}},_start:function(){var e=this.el.get(0).files;if(this._validateInput(e)){this._resetInput();return}if(this._validateFiles(e)){this._resetInput();return}this.el.trigger("lu:before",[e]);this._performUpload(this._collateFormData(e))},_resetInput:function(){this.el.val("")},_validateInput:function(e){var t=[];if(!this.el.attr("name")){t.push("the file input element must have a name attribute")}if(!this.options.script){t.push("the script option is required")}if(e.length===0){t.push("at least one file must be selected")}this.el.trigger("lu:errors",[[{name:"liteUploader_input",errors:t}]]);if(t.length>0){return true}return false},_validateFiles:function(e){var t=false,n=[];$.each(e,function(r){var i=this._findErrors(e[r]);n.push({name:e[r].name,errors:i});if(i.length>0){t=true}}.bind(this));this.el.trigger("lu:errors",[n]);return t},_findErrors:function(e){var t=[];$.each(this.options.rules,function(n,r){if(n==="allowedFileTypes"&&r&&$.inArray(e.type,r.split(","))===-1){t.push({type:"type",rule:r,given:e.type})}if(n==="maxSize"&&r&&e.size>r){t.push({type:"size",rule:r,given:e.size})}});return t},_getFormDataObject:function(){return new FormData},_collateFormData:function(e){var t=this._getFormDataObject();if(this.el.attr("id")){t.append("liteUploader_id",this.el.attr("id"))}$.each(this.params,function(e,n){t.append(e,n)});$.each(e,function(n){t.append(this.el.attr("name"),e[n])}.bind(this));return t},_performUpload:function(e){$.ajax({xhr:function(){return this.xhr}.bind(this),url:this.options.script,type:"POST",data:e,processData:false,contentType:false}).done(function(e){this.el.trigger("lu:success",e)}.bind(this)).fail(function(e){this.el.trigger("lu:fail",e)}.bind(this)).always(function(){this._resetInput()}.bind(this))},addParam:function(e,t){this.params[e]=t},cancelUpload:function(){this.xhr.abort();this.el.trigger("lu:cancelled");this._resetInput()}}
